# Raspberry pi в качестве сити-фермы для выращивания растений 

---

### О проекте

Данный проект нацелен на автоматическое выращивание растений и поддержания оптимальных условий для них, используя Raspberry pi 4

Raspberry pi является в роли клиента , который подключается к серверу на хосте. Raspberry и сервер связываются между собой с помощью библиотеки *python socket*, сокет в свою очередь обменивается данными с Flask, который отправляет и получает данные с react приложения. В корневой папке проекта содержиться две папки *raspi_client* и *server_client*, первую вы загружаете на raspberry, а вторую на любое другое устройство где можно развернуть *flask* и react


__Упрощенная модель__

Socket client <--> Socket server <--> Flask web-server <--> React


---

### Что нужно для полноценной работы
В проекте использовались датчики и реле. Реле вы можете использовать какое вам угодно (желательно модуль с минимум 2 реле), а вот если вы используете другие датчики, то нужно будет изменить файл *check_sensor.py* находящийся в модуле *check*, в папке *client_raspbery_pi*, также нужно изменить файл __requirements.txt__ и все импорты библиотек для датчиков

#### Список датчиков
* Датчик температуры и влажности *am2320*
* Датчик температуры раствора в металической гильзе (название отсутсвует)
* Датчик уровня освещенности *bh1750*
* Поплавковый датчик уровня жидкости
* АЦП *ads1015* для датчика расхода литров (код для ads пока просто прописан в коде т.к отствует сам расходомер)

<img src="mem.jpg" width=200 height=200>


> Проект будет работать без реле и датчиков, просто на веб странице вы увидите опевещение о том что датчик не подключен

---
### Запуск проекта

#### Настройка стороны клиента Raspberry 

Для начала на расбери нужно будет открыть порт i2c для датчика *am2320*, *bh1750* и АЦП *ads1015*. 

Как открыть i2c -> https://www.mathworks.com/help/supportpkg/raspberrypiio/ref/enablei2c.html

Загрузите папку *raspi_client* на raspberry pi. Внутри папки будут два файла *init.sh* и *start.sh*. Инит запускаем 1 раз для создания виртуальной среды python и установки всех необходимых библиотек, а дальше для запуска используйте файл *start.sh*

Вы увидете папку *client_raspberry_pi*, в ней будет код самого проекта написанный на языке python. Файл *app.py* является основным, __внутри бедет константа IP_AND_PORT в ней нужно будет указать ip сервера к которому должени подключиться расбери__. Папка *check* служит модулем для обработки датчиков, реле и установки номеров нужных пинов. В каждом файле *python* есть описание назначения функций

Также вы могли заметить папку *default*, в ней хранится *json* файл, который сохраняет состояние системы, чтобы если мы отключили, а потом запустили проект заново, то он запустился бы в том состояние в котором был при отключении

---

### Настройка стороны сервера Flask и связь с React приложением


__React__<br/> 
Для  запуска React вы должны установить *nodejs* версии 16.x и менеджер пакетв npm. Здесь вы можете посмотреть как поставить нужную версию *nodejs* <https://www.digitalocean.com/community/tutorials/how-to-install-node-js-on-ubuntu-20-04-ru>

На стороне сервера загрузите папку из корневого каталога *server_client*. __Вам потребуется указать *ip flask* сервера в файле config.js находящийся по пути *server_client\client_react\src\utils\config.js*__.
Запуск *React* приложения осуществляется консольной командой:
> __npm start__ 

(Также вы можете почитать о том как собрать *React build*) 

__Flask__<br/>
Для начала понадобятся python библиотеки *flask* и *flask-cors*. Установить их можно командой: 
>__pip3 install flask, flask-cors__

Теперь переходим к запуску серверу Flask. В файле *server.py* нужно указать __ip__, также как мы делали на расбери. Запуск вы можете осуществить зайдя в папку *server_flask* и просто при помощи консоли запустить сервер командой:
> __python3 app.py__ 

(в вирутальной среде просто __python app.py__)



